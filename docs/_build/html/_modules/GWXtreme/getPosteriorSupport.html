
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>GWXtreme.getPosteriorSupport &#8212; GWXtreme 0 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for GWXtreme.getPosteriorSupport</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2018 Shaon Ghosh, Xiaoshu Liu</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify it</span>
<span class="c1"># under the terms of the GNU General Public License as published by the</span>
<span class="c1"># Free Software Foundation; either version 2 of the License, or (at your</span>
<span class="c1"># option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful, but</span>
<span class="c1"># WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General</span>
<span class="c1"># Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along</span>
<span class="c1"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>

<span class="kn">import</span> <span class="nn">lal</span>
<span class="kn">import</span> <span class="nn">lalsimulation</span> <span class="k">as</span> <span class="nn">lalsim</span>

<span class="kn">from</span> <span class="nn">.bounded_2d_kde</span> <span class="k">import</span> <span class="n">Bounded_2d_kde</span>


<span class="c1">#-------------------------------------------------</span>

<div class="viewcode-block" id="getMasses"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.getMasses">[docs]</a><span class="k">def</span> <span class="nf">getMasses</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Given chirp-mass and mass ratio, compute the individual masses</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">m1</span> <span class="o">=</span> <span class="n">mc</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">m2</span> <span class="o">=</span> <span class="n">mc</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">)</span></div>

<div class="viewcode-block" id="getLambdaT"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.getLambdaT">[docs]</a><span class="k">def</span> <span class="nf">getLambdaT</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">Lambda1</span><span class="p">,</span> <span class="n">Lambda2</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function converts the Lambda1, Lambda2, mass1, mass2</span>
<span class="sd">    to Lambda tilde.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">LambdaTilde</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">26</span><span class="o">*</span><span class="p">(</span><span class="n">m1</span> <span class="o">+</span> <span class="n">m2</span><span class="p">)</span><span class="o">**</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">LambdaTilde</span> <span class="o">*=</span> <span class="p">(</span><span class="n">m1</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">m2</span><span class="o">*</span><span class="n">m1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">Lambda1</span> <span class="o">+</span>\
                   <span class="p">(</span><span class="n">m2</span><span class="o">**</span><span class="mi">5</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">m1</span><span class="o">*</span><span class="n">m2</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">Lambda2</span>
    <span class="k">return</span> <span class="n">LambdaTilde</span></div>

<span class="c1">#-------------------------------------------------</span>

<div class="viewcode-block" id="GetPosteriorSupport"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.GetPosteriorSupport">[docs]</a><span class="k">class</span> <span class="nc">GetPosteriorSupport</span><span class="p">:</span>
<div class="viewcode-block" id="GetPosteriorSupport.__init__"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.GetPosteriorSupport.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">posteriorFile</span><span class="p">,</span> <span class="n">priorFile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Initiates the Bayes factor calculator with the posterior</span>
<span class="sd">        samples from the uniform LambdaT, dLambdaT parameter</span>
<span class="sd">        estimation runs.</span>

<span class="sd">        posteriorFile :: The full path to the posterior_samples.dat</span>
<span class="sd">                         file</span>

<span class="sd">        priorFile     :: The full path to the priors file (optional).</span>
<span class="sd">                         If the prior file is supplied, the mass</span>
<span class="sd">                         boundaries for the KDE computation is</span>
<span class="sd">                         obtained from the prior file. If this is not</span>
<span class="sd">                         supplied, the posterior samples will be used</span>
<span class="sd">                         to determine the bounds.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recfromtxt</span><span class="p">(</span><span class="n">posteriorFile</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">priorFile</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">recfromtxt</span><span class="p">(</span><span class="n">priorFile</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;m2&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;m1&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prior</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prior</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;m2&#39;</span><span class="p">])</span>  <span class="c1"># min of mass in posterior</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;m1&#39;</span><span class="p">])</span>  <span class="c1"># max of mass in posterior</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">q_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>

        <span class="c1">### store useful parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;mc&#39;</span><span class="p">])</span>

        <span class="c1">### whiten data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_LambdaT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lambdat&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">q_min</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_q</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yhigh</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">var_q</span> <span class="c1"># For reflection boundary condition</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">margPostData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;lambdat&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">var_LambdaT</span><span class="p">,</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">var_q</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bw</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margPostData</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span>  <span class="c1"># Scott&#39;s bandwidth factor</span>

        <span class="c1"># Compute the KDE for the marginalized posterior distribution #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kde</span> <span class="o">=</span> <span class="n">Bounded_2d_kde</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margPostData</span><span class="p">,</span>
                                  <span class="n">xlow</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                  <span class="n">xhigh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">ylow</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                  <span class="n">yhigh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yhigh</span><span class="p">,</span>
                                  <span class="n">bw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bw</span><span class="p">)</span></div>

<div class="viewcode-block" id="GetPosteriorSupport.getEoSInterp"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.GetPosteriorSupport.getEoSInterp">[docs]</a>    <span class="k">def</span> <span class="nf">getEoSInterp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eosname</span><span class="p">,</span> <span class="n">m_min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method accepts one of the NS native equations of state</span>
<span class="sd">        and uses that to return a list [s, mass, Λ, max_mass] where</span>
<span class="sd">        s is the interpolation function for the mass and the tidal</span>
<span class="sd">        deformability.</span>

<span class="sd">        eosname     :: Equation of state native to LALsuite</span>

<span class="sd">        m_min       :: The minimum mass of the NS from which value</span>
<span class="sd">                       the interpolant will be constructed</span>
<span class="sd">                       (default = 1.0).</span>

<span class="sd">        N           :: Number of points that will be used for the</span>
<span class="sd">                       construction of the interpolant.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">allowedEoS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ALF1&#39;</span><span class="p">,</span> <span class="s1">&#39;ALF2&#39;</span><span class="p">,</span> <span class="s1">&#39;ALF3&#39;</span><span class="p">,</span> <span class="s1">&#39;ALF4&#39;</span><span class="p">,</span> <span class="s1">&#39;AP1&#39;</span><span class="p">,</span> <span class="s1">&#39;AP2&#39;</span><span class="p">,</span> <span class="s1">&#39;AP3&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;AP4&#39;</span><span class="p">,</span> <span class="s1">&#39;APR4_EPP&#39;</span><span class="p">,</span> <span class="s1">&#39;BBB2&#39;</span><span class="p">,</span> <span class="s1">&#39;BGN1H1&#39;</span><span class="p">,</span> <span class="s1">&#39;BPAL12&#39;</span><span class="p">,</span> <span class="s1">&#39;BSK19&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;BSK20&#39;</span><span class="p">,</span> <span class="s1">&#39;BSK21&#39;</span><span class="p">,</span> <span class="s1">&#39;ENG&#39;</span><span class="p">,</span> <span class="s1">&#39;FPS&#39;</span><span class="p">,</span> <span class="s1">&#39;GNH3&#39;</span><span class="p">,</span> <span class="s1">&#39;GS1&#39;</span><span class="p">,</span> <span class="s1">&#39;GS2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;H1&#39;</span><span class="p">,</span> <span class="s1">&#39;H2&#39;</span><span class="p">,</span> <span class="s1">&#39;H3&#39;</span><span class="p">,</span> <span class="s1">&#39;H4&#39;</span><span class="p">,</span> <span class="s1">&#39;H5&#39;</span><span class="p">,</span> <span class="s1">&#39;H6&#39;</span><span class="p">,</span> <span class="s1">&#39;H7&#39;</span><span class="p">,</span> <span class="s1">&#39;MPA1&#39;</span><span class="p">,</span> <span class="s1">&#39;MS1B&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;MS1B_PP&#39;</span><span class="p">,</span> <span class="s1">&#39;MS1_PP&#39;</span><span class="p">,</span> <span class="s1">&#39;MS1&#39;</span><span class="p">,</span> <span class="s1">&#39;MS2&#39;</span><span class="p">,</span> <span class="s1">&#39;PAL6&#39;</span><span class="p">,</span> <span class="s1">&#39;PCL2&#39;</span><span class="p">,</span> <span class="s1">&#39;PS&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;QMC700&#39;</span><span class="p">,</span> <span class="s1">&#39;SLY4&#39;</span><span class="p">,</span> <span class="s1">&#39;SLY&#39;</span><span class="p">,</span> <span class="s1">&#39;SQM1&#39;</span><span class="p">,</span> <span class="s1">&#39;SQM2&#39;</span><span class="p">,</span> <span class="s1">&#39;SQM3&#39;</span><span class="p">,</span> <span class="s1">&#39;WFF1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;WFF2&#39;</span><span class="p">,</span> <span class="s1">&#39;WFF3&#39;</span><span class="p">,</span> <span class="s1">&#39;APR&#39;</span><span class="p">,</span> <span class="s1">&#39;BHF_BBB2&#39;</span><span class="p">,</span> <span class="s1">&#39;KDE0V&#39;</span><span class="p">,</span> <span class="s1">&#39;KDE0V1&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;RS&#39;</span><span class="p">,</span> <span class="s1">&#39;SK255&#39;</span><span class="p">,</span> <span class="s1">&#39;SK272&#39;</span><span class="p">,</span> <span class="s1">&#39;SKA&#39;</span><span class="p">,</span> <span class="s1">&#39;SKB&#39;</span><span class="p">,</span> <span class="s1">&#39;SKI2&#39;</span><span class="p">,</span> <span class="s1">&#39;SKI3&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;SKI4&#39;</span><span class="p">,</span> <span class="s1">&#39;SKI5&#39;</span><span class="p">,</span> <span class="s1">&#39;SKI6&#39;</span><span class="p">,</span> <span class="s1">&#39;SKMP&#39;</span><span class="p">,</span> <span class="s1">&#39;SKOP&#39;</span><span class="p">,</span> <span class="s1">&#39;SLY2&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;SLY230A&#39;</span><span class="p">,</span> <span class="s1">&#39;SLY9&#39;</span><span class="p">,</span> <span class="s1">&#39;HQC18&#39;</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">eosname</span> <span class="ow">in</span> <span class="n">allowedEoS</span>
        <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;EoS family is not available in lalsimulation&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Allowed EoS are :</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">allowedEoS</span><span class="p">))</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">eos</span> <span class="o">=</span> <span class="n">lalsim</span><span class="o">.</span><span class="n">SimNeutronStarEOSByName</span><span class="p">(</span><span class="n">eosname</span><span class="p">)</span>
        <span class="n">fam</span> <span class="o">=</span> <span class="n">lalsim</span><span class="o">.</span><span class="n">CreateSimNeutronStarFamily</span><span class="p">(</span><span class="n">eos</span><span class="p">)</span>
        <span class="n">max_mass</span> <span class="o">=</span> <span class="n">lalsim</span><span class="o">.</span><span class="n">SimNeutronStarMaximumMass</span><span class="p">(</span><span class="n">fam</span><span class="p">)</span><span class="o">/</span><span class="n">lal</span><span class="o">.</span><span class="n">MSUN_SI</span>

        <span class="c1"># This is necessary so that interpolant is computed over the full range</span>
        <span class="c1"># Keeping number upto 3 decimal places</span>
        <span class="c1"># Not rounding up, since that will lead to RuntimeError</span>
        <span class="n">max_mass</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_mass</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">m_min</span><span class="p">,</span> <span class="n">max_mass</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="n">masses</span><span class="p">[</span><span class="n">masses</span> <span class="o">&lt;=</span> <span class="n">max_mass</span><span class="p">]</span>
        <span class="n">Lambdas</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">gravMass</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">masses</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rr</span> <span class="o">=</span> <span class="n">lalsim</span><span class="o">.</span><span class="n">SimNeutronStarRadius</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">lal</span><span class="o">.</span><span class="n">MSUN_SI</span><span class="p">,</span> <span class="n">fam</span><span class="p">)</span>
                <span class="n">kk</span> <span class="o">=</span> <span class="n">lalsim</span><span class="o">.</span><span class="n">SimNeutronStarLoveNumberK2</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">lal</span><span class="o">.</span><span class="n">MSUN_SI</span><span class="p">,</span> <span class="n">fam</span><span class="p">)</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="n">m</span><span class="o">*</span><span class="n">lal</span><span class="o">.</span><span class="n">MRSUN_SI</span><span class="o">/</span><span class="n">rr</span>
                <span class="n">Lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Lambdas</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">kk</span><span class="o">/</span><span class="p">(</span><span class="n">cc</span><span class="o">**</span><span class="mi">5</span><span class="p">))</span>
                <span class="n">gravMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gravMass</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">Lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Lambdas</span><span class="p">)</span>
        <span class="n">gravMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gravMass</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">gravMass</span><span class="p">,</span> <span class="n">Lambdas</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">gravMass</span><span class="p">,</span> <span class="n">Lambdas</span><span class="p">,</span> <span class="n">max_mass</span><span class="p">]</span></div>

<div class="viewcode-block" id="GetPosteriorSupport.getEoSInterpFromFile"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.GetPosteriorSupport.getEoSInterpFromFile">[docs]</a>    <span class="k">def</span> <span class="nf">getEoSInterpFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tidalFile</span><span class="p">,</span> <span class="n">m_min</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The method accepts a text file with columns defining the</span>
<span class="sd">        mass (M_sun) and the dimensionless tidal deformabiliy Λ,</span>
<span class="sd">        and returns a list [s, mass, Λ, max_mass] where s is the</span>
<span class="sd">        interpolation function for the mass and the tidal</span>
<span class="sd">        deformability</span>

<span class="sd">        tidalFile       :: Name of the tidal file must be in the</span>
<span class="sd">                           following form:</span>
<span class="sd">                            mass       Λ</span>

<span class="sd">                            ...	       ...</span>

<span class="sd">                            ...	       ...</span>

<span class="sd">                            max_mass   ...</span>

<span class="sd">        m_min       :: The minimum mass of the NS from which value</span>
<span class="sd">                       the interpolant will be constructed</span>
<span class="sd">                       (default = 1.0).</span>
<span class="sd">        N           :: Number of points that will be used for the</span>
<span class="sd">                       construction of the interpolant.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">masses</span><span class="p">,</span> <span class="n">Lambdas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">tidalFile</span><span class="p">,</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">max_mass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">masses</span><span class="p">)</span>
        <span class="n">max_mass</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_mass</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minMass</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">masses</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">masses</span><span class="p">,</span> <span class="n">Lambdas</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">masses</span><span class="p">,</span> <span class="n">Lambdas</span><span class="p">,</span> <span class="n">max_mass</span><span class="p">]</span></div>

<div class="viewcode-block" id="GetPosteriorSupport.computeEvidenceRatio"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.GetPosteriorSupport.computeEvidenceRatio">[docs]</a>    <span class="k">def</span> <span class="nf">computeEvidenceRatio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">EoS1</span><span class="p">,</span> <span class="n">EoS2</span><span class="p">,</span>
                             <span class="n">gridN</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">trials</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method computes the ratio of evidences for two</span>
<span class="sd">        tabulated EoS. It first checks if a file exists with</span>
<span class="sd">        the name associated with the strings EoS1 and EoS2.</span>
<span class="sd">        If it does, then use method getEoSInterpFromFile,</span>
<span class="sd">        else use method getEoSInterp. This computation is</span>
<span class="sd">        conducted for multiple trials to get an estimation of</span>
<span class="sd">        the uncertainty.</span>

<span class="sd">        EoS1    :: The name of the first tabulated equation of</span>
<span class="sd">                   state or the name of the file from which the</span>
<span class="sd">                   EoS data is to be read.</span>
<span class="sd">        EoS2    :: The name of the second tabulated equation of</span>
<span class="sd">                   state or the name of the file from which the</span>
<span class="sd">                   EoS data is to be read.</span>
<span class="sd">        gridN   :: Number of grid points over which the</span>
<span class="sd">                   line-integral is computed. (Default = 1000)</span>
<span class="sd">        trials  :: Number of trials for estimating the</span>
<span class="sd">                   uncertainty in the Bayes-factor.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1">### generate interpolators for both EOS</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">EoS1</span><span class="p">):</span>
            <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>
             <span class="n">max_mass_eos1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEoSInterpFromFile</span><span class="p">(</span><span class="n">EoS1</span><span class="p">,</span>
                                                        <span class="n">m_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minMass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>
             <span class="n">max_mass_eos1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEoSInterp</span><span class="p">(</span><span class="n">EoS1</span><span class="p">,</span>
                                                <span class="n">m_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minMass</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">EoS2</span><span class="p">):</span>
            <span class="p">[</span><span class="n">s2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>
             <span class="n">max_mass_eos2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEoSInterpFromFile</span><span class="p">(</span><span class="n">EoS2</span><span class="p">,</span>
                                                        <span class="n">m_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minMass</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="p">[</span><span class="n">s2</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span>
             <span class="n">max_mass_eos2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEoSInterp</span><span class="p">(</span><span class="n">EoS2</span><span class="p">,</span>
                                                <span class="n">m_min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minMass</span><span class="p">)</span>

        <span class="c1">### compute support</span>
        <span class="p">[</span><span class="n">lambdat_eos1</span><span class="p">,</span>
         <span class="n">q_eos1</span><span class="p">,</span> <span class="n">support2D1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">mc_mean</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span>
                                               <span class="n">max_mass_eos1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="p">,</span>
                                               <span class="n">gridN</span><span class="o">=</span><span class="n">gridN</span><span class="p">,</span>
                                               <span class="n">var_LambdaT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_LambdaT</span><span class="p">,</span>
                                               <span class="n">var_q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_q</span><span class="p">)</span>

        <span class="p">[</span><span class="n">lambdat_eos2</span><span class="p">,</span>
         <span class="n">q_eos2</span><span class="p">,</span> <span class="n">support2D2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">mc_mean</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span>
                                               <span class="n">max_mass_eos2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="p">,</span>
                                               <span class="n">gridN</span><span class="o">=</span><span class="n">gridN</span><span class="p">,</span>
                                               <span class="n">var_LambdaT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_LambdaT</span><span class="p">,</span>
                                               <span class="n">var_q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_q</span><span class="p">)</span>

        <span class="c1">### iterate to determine uncertainty via re-drawing from</span>
        <span class="c1">### smoothed distribution</span>
        <span class="c1">### NOTE: this is known to introduce a non-zero bias into</span>
        <span class="c1">### the mean and variance estimate!</span>
        <span class="n">support2D1_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">support2D2_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">trials</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">support2D1</span><span class="o">/</span><span class="n">support2D2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">trials</span><span class="p">):</span>

            <span class="c1">### generate new (synthetic) data</span>
            <span class="n">new_margPostData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
            <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_margPostData</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margPostData</span><span class="p">):</span>
                <span class="n">prune_adjust_factor</span> <span class="o">=</span> <span class="mf">1.1</span> <span class="o">+</span> <span class="n">counter</span><span class="o">/</span><span class="mf">10.</span>
                <span class="n">N_resample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margPostData</span><span class="p">)</span><span class="o">*</span><span class="n">prune_adjust_factor</span><span class="p">)</span>
                <span class="n">new_margPostData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kde</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">N_resample</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">unphysical</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_margPostData</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span>\
                             <span class="p">(</span><span class="n">new_margPostData</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">yhigh</span><span class="p">)</span> <span class="o">+</span>\
                             <span class="p">(</span><span class="n">new_margPostData</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">new_margPostData</span> <span class="o">=</span> <span class="n">new_margPostData</span><span class="p">[</span><span class="o">~</span><span class="n">unphysical</span><span class="p">]</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_margPostData</span><span class="p">))</span>
            <span class="n">chosen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margPostData</span><span class="p">))</span>
            <span class="n">new_margPostData</span> <span class="o">=</span> <span class="n">new_margPostData</span><span class="p">[</span><span class="n">chosen</span><span class="p">]</span>

            <span class="c1">### generate a new kde</span>
            <span class="n">new_kde</span> <span class="o">=</span> <span class="n">Bounded_2d_kde</span><span class="p">(</span><span class="n">new_margPostData</span><span class="p">,</span> <span class="n">xlow</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                     <span class="n">xhigh</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylow</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                     <span class="n">yhigh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yhigh</span><span class="p">,</span>
                                     <span class="n">bw</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bw</span><span class="p">)</span>

            <span class="c1">### integrate to get support</span>
            <span class="p">[</span><span class="n">this_lambdat_eos1</span><span class="p">,</span> <span class="n">this_q_eos1</span><span class="p">,</span>
             <span class="n">this_support2D1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">mc_mean</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span>
                                                <span class="n">max_mass_eos1</span><span class="p">,</span> <span class="n">new_kde</span><span class="p">,</span>
                                                <span class="n">gridN</span><span class="o">=</span><span class="n">gridN</span><span class="p">,</span>
                                                <span class="n">var_LambdaT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_LambdaT</span><span class="p">,</span>
                                                <span class="n">var_q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_q</span><span class="p">)</span>
            <span class="p">[</span><span class="n">this_lambdat_eos2</span><span class="p">,</span> <span class="n">this_q_eos2</span><span class="p">,</span>
             <span class="n">this_support2D2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">q_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">q_max</span><span class="p">,</span>
                                                <span class="bp">self</span><span class="o">.</span><span class="n">mc_mean</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span>
                                                <span class="n">max_mass_eos2</span><span class="p">,</span> <span class="n">new_kde</span><span class="p">,</span>
                                                <span class="n">gridN</span><span class="o">=</span><span class="n">gridN</span><span class="p">,</span>
                                                <span class="n">var_LambdaT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_LambdaT</span><span class="p">,</span>
                                                <span class="n">var_q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">var_q</span><span class="p">)</span>
            <span class="c1">### store the result</span>
            <span class="n">support2D1_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_support2D1</span><span class="p">)</span>
            <span class="n">support2D2_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_support2D2</span><span class="p">)</span>

        <span class="n">sup_array</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">support2D1_list</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">support2D2_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">support2D1</span><span class="o">/</span><span class="n">support2D2</span><span class="p">,</span> <span class="n">sup_array</span><span class="p">]</span></div>

    <span class="c1"># The integrator function #</span>
<div class="viewcode-block" id="GetPosteriorSupport.integrator"><a class="viewcode-back" href="../../code.html#GWXtreme.getPosteriorSupport.GetPosteriorSupport.integrator">[docs]</a>    <span class="k">def</span> <span class="nf">integrator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q_min</span><span class="p">,</span> <span class="n">q_max</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">eosfunc</span><span class="p">,</span>
                   <span class="n">max_mass_eos</span><span class="p">,</span> <span class="n">postfunc</span><span class="p">,</span>
                   <span class="n">gridN</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">var_LambdaT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">var_q</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function numerically integrates the KDE along the</span>
<span class="sd">        EoS curve.</span>

<span class="sd">        q_min  	:: Minimum value of mass-ratio for the EoS curve</span>

<span class="sd">        q_max  	:: Maximum value of mass-ratio for the EoS curve</span>

<span class="sd">        mc	:: Chirp mass (fixed to mean value of posterior)</span>

<span class="sd">        eosfunc	 :: interpolation function of Λ = eosfunc(m)</span>

<span class="sd">        max_mass_eos :: Maximum mass allowed by the EoS.</span>

<span class="sd">        postfunc :: K(Λ, q) KDE of the posterior distr</span>

<span class="sd">        gridN  :: Number of steps for the integration (default=1K)</span>

<span class="sd">        var_LambdaT :: Standard deviation of the LambdT</span>

<span class="sd">        var_q  :: Standard deviation of the mass-ratio</span>

<span class="sd">        If for the choice of mass-ratio and mc, the masses of one</span>
<span class="sd">        or both the object goes above the maximum mass of NS</span>
<span class="sd">        allowed by the EoS, then the object(s) is(are) treated as</span>
<span class="sd">        BH (Λ=0). If the masses are below the minimum mass, the</span>
<span class="sd">        points are excludeds from the integral.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">### scale these appropriately to evaluate prior bounds</span>
        <span class="n">q_min</span> <span class="o">*=</span> <span class="n">var_q</span>
        <span class="n">q_max</span> <span class="o">*=</span> <span class="n">var_q</span>

        <span class="c1">### get values for line integral</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">q_min</span><span class="p">,</span> <span class="n">q_max</span><span class="p">,</span> <span class="n">gridN</span><span class="p">)</span>
        <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span> <span class="o">=</span> <span class="n">getMasses</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">mc</span><span class="p">)</span>

        <span class="c1"># apply constraints</span>
        <span class="n">min_mass_violation_1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minMass</span>
        <span class="n">min_mass_violation_2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">minMass</span>
        <span class="n">min_mass_violation</span> <span class="o">=</span> <span class="n">min_mass_violation_1</span> <span class="o">+</span> <span class="n">min_mass_violation_2</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">m1</span><span class="p">[</span><span class="o">~</span><span class="n">min_mass_violation</span><span class="p">]</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">m2</span><span class="p">[</span><span class="o">~</span><span class="n">min_mass_violation</span><span class="p">]</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="o">~</span><span class="n">min_mass_violation</span><span class="p">]</span>

        <span class="c1"># determine when bodies are black holes</span>
        <span class="n">kerr_cases_1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">&gt;=</span> <span class="n">max_mass_eos</span>
        <span class="n">kerr_cases_2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">&gt;=</span> <span class="n">max_mass_eos</span>

        <span class="n">Lambda1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m1</span><span class="p">)</span>
        <span class="n">Lambda2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>

        <span class="c1"># interpolate from known curves to obtain tidal</span>
        <span class="c1"># deformabilities as a function of mass for the</span>
        <span class="c1"># rest of the points</span>
        <span class="n">Lambda1</span><span class="p">[</span><span class="o">~</span><span class="n">kerr_cases_1</span><span class="p">]</span> <span class="o">=</span> <span class="n">eosfunc</span><span class="p">(</span><span class="n">m1</span><span class="p">[</span><span class="o">~</span><span class="n">kerr_cases_1</span><span class="p">])</span>
        <span class="n">Lambda2</span><span class="p">[</span><span class="o">~</span><span class="n">kerr_cases_2</span><span class="p">]</span> <span class="o">=</span> <span class="n">eosfunc</span><span class="p">(</span><span class="n">m2</span><span class="p">[</span><span class="o">~</span><span class="n">kerr_cases_2</span><span class="p">])</span>

        <span class="c1"># compute chirp tidal deformability</span>
        <span class="n">LambdaT</span> <span class="o">=</span> <span class="n">getLambdaT</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">Lambda1</span><span class="p">,</span> <span class="n">Lambda2</span><span class="p">)</span>

        <span class="c1">### scale things back so they make sense with the KDE</span>
        <span class="n">LambdaT_scaled</span><span class="p">,</span> <span class="n">q_scaled</span> <span class="o">=</span> <span class="n">LambdaT</span><span class="o">/</span><span class="n">var_LambdaT</span><span class="p">,</span> <span class="n">q</span><span class="o">/</span><span class="n">var_q</span>

        <span class="c1">### perform integration via trapazoidal approximation</span>
        <span class="n">dq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">postfunc</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">LambdaT_scaled</span><span class="p">,</span> <span class="n">q_scaled</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">f_centers</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">f</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">int_element</span> <span class="o">=</span> <span class="n">f_centers</span> <span class="o">*</span> <span class="n">dq</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">LambdaT_scaled</span><span class="p">,</span> <span class="n">q_scaled</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">int_element</span><span class="p">)]</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">GWXtreme</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../code.html">Auto Generated Documentation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Shaon Ghosh.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>